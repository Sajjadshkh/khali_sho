# سیستم خرید و پرداخت خالی شو

این سیستم شامل قابلیت‌های زیر است:

## ویژگی‌ها

### 1. مدیریت پلن‌ها
- پلن‌های تلفنی و حضوری
- قابلیت تعریف مدت زمان و زمان اضافه
- قیمت‌گذاری انعطاف‌پذیر
- فعال/غیرفعال کردن پلن‌ها

### 2. سبد خرید
- اضافه کردن پلن‌ها به سبد خرید
- تغییر تعداد آیتم‌ها
- حذف آیتم‌ها
- محاسبه خودکار قیمت کل

### 3. سیستم OTP
- تایید شماره تلفن قبل از خرید
- امنیت بالا با کد یکبار مصرف

### 4. پرداخت آنلاین
- اتصال به درگاه شاپرک
- پردازش امن تراکنش‌ها
- تایید خودکار پرداخت‌ها

## نصب و راه‌اندازی

### 1. اجرای Migration ها
```bash
python manage.py makemigrations us
python manage.py migrate
```

### 2. ایجاد پلن‌های پیش‌فرض
```bash
python manage.py create_default_plans
```

### 3. تنظیم درگاه شاپرک
در فایل `settings.py` تنظیمات زیر را اضافه کنید:

```python
# تنظیمات درگاه شاپرک
SHAPARAK_TERMINAL_ID = 'YOUR_TERMINAL_ID'
SHAPARAK_MERCHANT_ID = 'YOUR_MERCHANT_ID'
SHAPARAK_PRIVATE_KEY = 'YOUR_PRIVATE_KEY'
SHAPARAK_CALLBACK_URL = 'https://yourdomain.com'
SHAPARAK_API_URL = 'https://api.shaparak.ir'
```

## نحوه استفاده

### 1. انتخاب پلن
کاربران می‌توانند از صفحه خدمات، پلن مورد نظر خود را انتخاب کنند.

### 2. تایید OTP
قبل از خرید، کاربر باید شماره تلفن خود را تایید کند.

### 3. تکمیل خرید
- مراجعه به سبد خرید
- بررسی جزئیات سفارش
- تکمیل اطلاعات تماس
- پرداخت از طریق درگاه شاپرک

### 4. تایید پرداخت
پس از پرداخت موفق، کاربر به صفحه موفقیت هدایت می‌شود.

## ساختار فایل‌ها

### مدل‌ها (`us/models.py`)
- `Plan`: پلن‌های خدمات
- `Cart`: سبد خرید
- `CartItem`: آیتم‌های سبد خرید
- `Order`: سفارشات
- `OrderItem`: آیتم‌های سفارش

### View ها (`us/views.py`)
- `add_to_cart`: اضافه کردن به سبد خرید
- `cart_view`: نمایش سبد خرید
- `checkout_view`: صفحه تسویه حساب
- `payment_view`: صفحه پرداخت
- `PaymentCallbackView`: دریافت callback از درگاه

### Template ها
- `services.html`: صفحه خدمات و پلن‌ها
- `cart.html`: سبد خرید
- `checkout.html`: تسویه حساب
- `payment.html`: پرداخت
- `order_success.html`: موفقیت پرداخت

### درگاه پرداخت (`us/shaparak.py`)
کلاس `ShaparakPayment` برای مدیریت ارتباط با درگاه شاپرک

## نکات مهم

### امنیت
- تمام پرداخت‌ها از طریق درگاه امن شاپرک انجام می‌شود
- تایید OTP قبل از خرید اجباری است
- امضای دیجیتال برای تایید تراکنش‌ها

### عملکرد
- سبد خرید بر اساس session مدیریت می‌شود
- شماره سفارش منحصر به فرد تولید می‌شود
- وضعیت سفارش‌ها قابل پیگیری است

### توسعه
- امکان اضافه کردن درگاه‌های پرداخت دیگر
- قابلیت اضافه کردن تخفیف و کد تخفیف
- امکان مدیریت موجودی پلن‌ها

## تست سیستم

برای تست سیستم بدون اتصال به درگاه واقعی:

1. تنظیمات شاپرک را خالی بگذارید
2. سیستم به صورت شبیه‌سازی کار خواهد کرد
3. برای تست واقعی، تنظیمات درگاه را وارد کنید

## پشتیبانی

در صورت بروز مشکل یا نیاز به راهنمایی، با تیم توسعه تماس بگیرید. 